# week 3 å¤šè·¯å¤é€‰å™¨ï¼›åŠ ã€ä¹˜æ³•å™¨

> åœ¨å­¦ä¹ æœ¬å‘¨è¯¾ç¨‹ä¹‹å‰ï¼Œä½ éœ€è¦
>
> - [ ] å­¦ä¼šverilogåŸºæœ¬è¿ç®—ç¬¦
>
>   [Verilog HDLâ€”â€”è¿ç®—ç¬¦_verilogé€»è¾‘è¿ç®—ç¬¦_~Oldçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_43460068/article/details/122001173)
>
>   [Verilogè¯­æ³•ä¹‹å››ï¼šè¿ç®—ç¬¦ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/72014513?ivk_sa=1024320u&utm_id=0)
>
> - [ ] å­¦ä¼štbæ–‡ä»¶å†™æ³•
>
>   [Verilog åŸºç¡€ä»¿çœŸæ–‡ä»¶ç¼–å†™_verilogä»¿çœŸç¨‹åºç¼–å†™_èƒŒå½±ç–¾é£çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/weixin_54358182/article/details/129495887)
>
> - [ ] å­¦ä¼šè¡¥ç åŠå…¶åŠ å‡æ³•
>
>   [åŸç -åç -è¡¥ç  --æ•°å­¦å…¬å¼åˆ†æ_åŸç åç è¡¥ç è®¡ç®—å…¬å¼åŠå…³ç³»-CSDNåšå®¢](https://blog.csdn.net/qq_34771697/article/details/77972501)
>
>   [ã€åŸåˆ›ã€‘è®¡ç®—æœºä¸ºä»€ä¹ˆè¦ç”¨è¡¥ç ï¼Ÿ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/105917577)
>
>   [ã€è®¡ç®—æœºç»„æˆåŸç†ã€‘è¡¥ç çš„åŠ å‡è¿ç®—æ–¹æ³•_è¡¥ç ç›¸åŠ æ€ä¹ˆç®—çš„-CSDNåšå®¢](https://blog.csdn.net/qq_43511405/article/details/105898286)
>
> - [ ] 

## å¤šè·¯å¤é€‰å™¨

ä½œç”¨ï¼šä»ä¸€ç»„è¾“å…¥æ•°æ®ä¸­é€‰å‡ºæŸä¸€ä¸ªæ¥

<img src="img resources/mux.png" alt="mux" style="zoom:33%;" />

æ ¸å¿ƒï¼šç”¨ä¸é—¨å½“åšå¼€å…³ï¼Œé€šè¿‡æ•°æ®ä¿¡å·å’Œæ§åˆ¶ä¿¡å·ç›¸ä¸å®ç°å„æ•°æ®çš„é€‰æ‹©æ•ˆæœ

### äºŒé€‰ä¸€

ç”µè·¯å›¾ï¼š<img src="img resources/MUX2.png" alt="MUX2.png" style="zoom: 50%;" />

verilogå®ç°æ–¹å¼ï¼š

- é—¨çº§ç”µè·¯ï¼ˆäº†è§£å³å¯ï¼‰

```verilog
module mux2_gate (
    input wire [7:0]a,b,
	input wire sel,
    output wire [7:0]y
);
    assign y = (a & {8{sel}}) | (b & {8{~sel}});
endmodule
```

- è¡Œä¸ºçº§æè¿°

```verilog
module mux2 (
	input wire[7:0] a,b,
	input wire sel,
	output wire[7:0] y
    );
		
	assign y = sel ? a : b;
endmodule //1=>a,0=>b
```

- å¸¦å‚æ•°çš„å¸¸ç”¨å†™æ³•

```verilog
module mux2_par #(
	parameter n=8
) (
	input wire[n-1:0] a,b,
	input wire sel,
	output wire[n-1:0] y	
);
	assign y = sel ? a : b;
endmodule
```

â€‹		è°ƒç”¨æ–¹å¼

``` verilog
mux2_par #(.n()) u_mux2_par (.a(),.b(),.sel(),.y());
```

### å››é€‰ä¸€

ç”µè·¯å›¾ï¼š<img src="img resources/MUX4.png" alt="MUX4" style="zoom: 50%;" />

verilogå®ç°æ–¹å¼ï¼š

- é—¨çº§ç”µè·¯ï¼ˆäº†è§£å³å¯ï¼‰

``` verilog
module mux4_gate (
	input wire [7:0]a,b,c,d,
	input wire [1:0]sel,
	output wire y
);
    assign y=(a&&~sel[0]&&~sel[1])|(b&&sel[0]&&~sel[1])|(c&&~sel[0]&&sel[1])|(d&&sel[0]&&sel[1]);
endmodule//00=>a,01=>b,10=>c,11=>d
```

- è¡Œä¸ºçº§æè¿°

```verilog
module mux4 (
	input  wire[7:0] a,b,c,d,
	input  wire[1:0] sel,
	output wire[7:0] y
    );
	
	assign y = sel[0] ? (sel[1] ? d : c) : (sel[1] ? b : a);
endmodule//00=>a,01=>b,10=>c,11=>d
```

- å¸¦å‚æ•°çš„å¸¸ç”¨å†™æ³•

``` verilog
module mux4_par #(
	parameter n=8
) (
    input  wire[n-1:0] a,b,c,d,
	input  wire[1:0] sel,
    output wire[n-1:0] y
    );
	
	assign y = sel[0] ? (sel[1] ? d : c) : (sel[1] ? b : a);
endmodule//00=>a,01=>b,10=>c,11=>d
```

â€‹		è°ƒç”¨æ–¹å¼

``` verilog
mux4_par #(.n()) u_mux4_par (.a(),.b(),.c(),.d(),.sel(),.y());
```



> æœ¬ç« ä½ éœ€è¦å­¦ä¼šçš„
>
> - [ ] å¸¦å‚æ•°çš„å†™æ³•åŠå…¶è°ƒç”¨æ–¹æ³•



## åŠ æ³•å™¨

### åŠåŠ å™¨

åªå°†ä¸¤ä¸ª1ä½äºŒè¿›åˆ¶æ•°ç›¸åŠ ï¼Œä¸è€ƒè™‘ä½ä½è¿›ä½ã€‚

- çœŸå€¼è¡¨

<table border="4" >
	<tr align =center>
		<td colspan="2">è¾“å…¥</td>
        <td colspan="2">è¾“å‡º</td>
	</tr>
	<tr align =center>
		<td>A</td>
		<td>B</td>
        <td>S</td>
        <td>CO</td>
	</tr>
    <tr align =center>
        <td>0</td>
		<td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr align =center>
        <td>0</td>
		<td>1</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr align =center>
        <td>1</td>
		<td>0</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr align =center>
        <td>1</td>
		<td>1</td>
        <td>0</td>
        <td>1</td>
    </tr>
</table>
- é€»è¾‘å‡½æ•°

$$
S=\overline{A}B+A\overline{B}=A\oplus B\\
CO=AB
$$
- ç”µè·¯å›¾

<img src="img resources/half_adder.png" alt="half_adder" style="zoom:61%;" />

- verilogå®ç°æ–¹å¼

```verilog
module half_adder (
    input  a,b,
    output s
);

assign s = a ^ b;
endmodule
```

### å…¨åŠ å™¨

é™¤äº†è¦å°†ä¸¤ä¸ª1ä½äºŒè¿›åˆ¶æ•°ç›¸åŠ å¤–ï¼Œè¿˜æœ‰è€ƒè™‘æ¥è‡ªä½ä½çš„è¿›ä½ã€‚

- çœŸå€¼è¡¨

<table border="5" >
	<tr align =center>
		<td colspan="3">è¾“å…¥</td>
        <td colspan="2">è¾“å‡º</td>
	</tr>
	<tr align =center>
        <td>CI</td>
		<td>A</td>
		<td>B</td>
        <td>S</td>
        <td>CO</td>
	</tr>
    <tr align =center>
        <td>0</td>
        <td>0</td>
		<td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr align =center>
        <td>0</td>
        <td>0</td>
		<td>1</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr align =center>
        <td>0</td>
        <td>1</td>
		<td>0</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr align =center>
        <td>0</td>
        <td>1</td>
		<td>1</td>
        <td>0</td>
        <td>1</td>
    </tr>
    <tr align =center>
        <td>1</td>
        <td>0</td>
		<td>0</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr align =center>
        <td>1</td>
        <td>0</td>
		<td>1</td>
        <td>0</td>
        <td>1</td>
    </tr>
    <tr align =center>
        <td>1</td>
        <td>1</td>
		<td>0</td>
        <td>0</td>
        <td>1</td>
    </tr>
    <tr align =center>
        <td>1</td>
        <td>1</td>
		<td>1</td>
        <td>1</td>
        <td>1</td>
    </tr>
</table>

- ~~é€»è¾‘å‡½æ•°~~ å¯ä»¥é€šè¿‡ä¸¤ä¸ªåŠåŠ å™¨ä¸²è”ä¿®æ”¹å®ç°

$$
S=A\oplus B\oplus CI\\
CO=AB+\left( A+B\right) \left( CI\right)
$$



- ç”µè·¯å›¾

<img src="img resources/full_adder.png" alt="full_adder" style="zoom:61%;" />

- verilogå®ç°æ–¹å¼

```verilog
module adder_1bit (
    input a,b,ci,
    output s,co
);

assign s = a^b^ci;
assign co = (a&b)|(ci&(a^b));
endmodule
```

### å¤šä½åŠ æ³•å™¨

#### è¡Œæ³¢è¿›ä½åŠ æ³•å™¨ï¼ˆRipple-carry adderï¼‰

- ç¤ºæ„å›¾

<img src="img resources/RCA.jpg" alt="ripple_carry_adder" style="zoom: 67%;" />

å¦‚åŒæ³¢ä¸€èˆ¬å‘å‰è®¡ç®—ã€‚æ¯æ¬¡è¿ç®—éœ€è¦ç­‰å¾…å‰ä¸€ä½çš„è¿›ä½å€¼ï¼Œç”±å…¨åŠ å™¨çš„ç”µè·¯å›¾å¯çŸ¥ï¼Œä»cinåˆ°coutæœ‰ä¸¤çº§é—¨ç”µè·¯çš„æ—¶å»¶ï¼Œæ‰€ä»¥å¯¹äºNä½è¡Œæ³¢è¿›ä½åŠ æ³•å™¨ï¼Œæ—¶å»¶å°±æ˜¯$3+(N-1)*2=2N+1$çº§ã€‚å¯è§ï¼Œåœ¨ä½æ•°æ›´é«˜çš„RCAä¸­ï¼Œä¸²è¡Œè®¡ç®—å¸¦æ¥çš„æ—¶å»¶ä¼šç›¸å½“å¤§ï¼Œè¿™å¯¹äºç°ä»£é«˜é€Ÿè¿ç®—æ˜¯ä¸å¯å¿å—çš„ã€‚

- verilogå®ç°æ–¹å¼

```verilog
module adder_8bit (
    input  [7:0] a,b,
    input        ci,
    output [7:0] s,
    output       co
);

wire [8:0] temp_co;

assign temp_co[0] = ci;

generate
    genvar i;
    for (i = 0;i<8 ;i=i+1 ) begin:adder_simple
        adder_1bit adder_unit(.a(a[i]),.b(b[i]),.ci(temp_co[i]),.s(s[i]),.co(temp_co[i+1]));
    end
endgenerate

assign co=temp_co[8];
endmodule
```

#### è¶…å‰è¿›ä½åŠ æ³•å™¨ï¼ˆCarry-lookahead Adderï¼‰

ä¸ºäº†æé«˜è¿ç®—é€Ÿåº¦ï¼Œå¿…é¡»è®¾æ³•å‡å°æˆ–æ¶ˆé™¤ç”±äºè¿›ä½ä¿¡å·é€çº§ä¼ é€’æ‰€è€—è´¹çš„æ—¶é—´ï¼Œäºæ˜¯è®¾è®¡å‡ºè¶…å‰è¿›ä½åŠ æ³•å™¨ã€‚

##### è¶…å‰è¿›ä½é€»è¾‘


ä¸¤ä¸ªå¤šä½æ•°ä¸­ç¬¬*i*ä½ç›¸åŠ äº§ç”Ÿçš„è¿›ä½è¾“å‡º$(CO)_i$å¯è¡¨ç¤ºä¸º
$$
(CO)_i=A_iB_i+\left( A_i+B_i\right) \left( CI\right)_i
$$
æˆ‘ä»¬å°†$G_i = A_iB_i$ç§°ä¸ºè¿›ä½ç”Ÿæˆå‡½æ•°ï¼Œå°†$P_i = (A_i+B_i)(CI)_i$ç§°ä¸ºè¿›ä½ä¼ é€’å‡½æ•°ã€‚

é€šè¿‡æ•°å­¦è®¡ç®—å±•å¼€å¯å¾—
$$
\left( CO\right) _{i}=G_{i}+P_{i}G_{i-1}+P_{i}P_{i-1}G_{i-2}+\ldots +P_{i}P_{i-1}\ldots P_{1}G_{0}
+P_{i}P_{i-1}\ldots P_{0}G_{0}
$$
äºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†ä»»æ„ä¸€ä½äº§ç”Ÿçš„è¿›ä½ï¼Œé¿å…äº†ç­‰å¾…è¿›ä½ä¿¡å·çš„é€çº§ä¼ é€’ï¼Œå°†å®ç°ä¸Šè¿°é€»è¾‘çš„ç”µè·¯ç§°ä¸º**CLU**ï¼ˆCarry Lookahead Unitï¼‰ã€‚ç”±å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œå¹¶è¡Œç”Ÿæˆå„çº§$C_i$çš„æ—¶å»¶æ¥è‡ª$G_i$å’Œ$P_i$çš„å…ˆä¸åæˆ–ï¼Œå†åŠ ä¸Šç”Ÿæˆ$G_i$å’Œ$P_i$çš„ä¸€çº§é—¨ç”µè·¯ï¼Œæ€»å…±æ˜¯ä¸‰çº§é—¨ç”µè·¯æ—¶å»¶ã€‚è€Œä¸”å¯ä»¥çœ‹å‡ºï¼Œæ—¶å»¶çš„çº§æ•°å¹¶ä¸ä¼šéšä½æ•°çš„å¢åŠ è€Œå¢åŠ ï¼Œä¸è®ºå¤šå°‘ä½CLAï¼Œç”Ÿæˆå„çº§$C_i$çš„æ—¶å»¶æ’ä¸ºä¸‰çº§é—¨ç”µè·¯ã€‚



ç”±å…¨åŠ å™¨çš„çœŸå€¼è¡¨å¯å¾—ç¬¬$i$ä½å’Œ$S_i$çš„é€»è¾‘å¼
$$
S_i=A_i\oplus B_i\oplus (CI)_i \ \ \ æˆ– \ \ \ S_i= \sim G_i P_i\oplus (CI)_i
$$
åŒæ ·ä¸è¶…è¿‡ä¸‰çº§é—¨ç”µè·¯



##### 4ä½è¶…å‰è¿›ä½åŠ æ³•å™¨

```verilog
module CLA4 (
    input [3:0]a,b,
    input ci,
    output [3:0]s,
    output co
);

wire [3:0]G,P;
wire [3:0]co_buf,ci_buf;

generate
    genvar i;
    for (i = 0;i<4 ;i=i+1 ) begin
       assign G[i] = a[i] & b[i];
       assign P[i] = a[i] | b[i];
    end
endgenerate

assign co_buf[0]=G[0] | G[0]&ci;
assign co_buf[1]=G[1] | P[1]&G[0] | P[1]&P[0]&ci;
assign co_buf[2]=G[2] | P[2]&G[1] | P[2]&P[1]&G[0] | P[2]&P[1]&P[0]&ci;
assign co_buf[3]=G[3] | P[3]&G[2] | P[3]&P[2]&G[1] | P[3]&P[2]&P[1]&G[0] | P[3]&P[2]&P[1]&P[0]&ci;
assign co = co_buf[3];
            
assign ci_buf = {co_buf[2:0],1'b0};

generate
	genvar i;
	for (i = 0;i<4 ;i=i+1) begin
		assign s[i] = ~G[0] & P[i] ^ ci_buf[i];
	end
endgenerate
    
endmodule
```

##### æ›´å¤šä½è¶…å‰è¿›ä½åŠ æ³•å™¨

åœ¨è®¾è®¡å‡º4ä½è¶…å‰è¿›ä½åŠ æ³•å™¨åï¼Œä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯ï¼šè¦æƒ³å¾—åˆ°æ›´å¤šä½CLAï¼Œåªéœ€åƒ4ä½CLAé‚£æ ·ï¼Œåªæ˜¯å¤šé€’å½’å‡ æ¬¡çš„åŒºåˆ«ã€‚è¿™ä¸ªæ–¹æ³•å«**å…¨è¶…å‰è¿›ä½**ã€‚å…¨è¶…å‰è¿›ä½ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†ç”±CLUçš„å…¬å¼å¯çŸ¥ï¼Œéšç€ä½æ•°çš„å¢åŠ ï¼Œå®ç°CLUçš„é—¨ç”µè·¯æ•°é‡ä¼šæ€¥å‰§å¢åŠ ï¼Œå¯¼è‡´ç”µè·¯é¢ç§¯å¼€é”€è¿‡å¤§ï¼›å¦ä¸€æ–¹é¢ï¼Œä½æ•°çš„å¢åŠ ä¹Ÿä¼šä½¿æ‰‡å…¥é£é€Ÿå¢å¤§ï¼Œå¯¼è‡´æ—¶å»¶å¢åŠ ã€‚

**æ‰€ä»¥ï¼Œå•çº¯çš„é€’å½’å¹¶ä¸æ˜¯å¥½çš„è§£å†³æ–¹æ¡ˆã€‚**

ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å€Ÿé‰´RCAã€‚å°†å¤šä¸ª4ä½CLAçº§è”ï¼Œå³é‡‡ç”¨â€œç»„å†…è¶…å‰è¿›ä½ï¼Œç»„é—´ä¸²è¡Œè¿›ä½â€œæ¥æ„æˆæ›´å¤šä½è¶…å‰è¿›ä½åŠ æ³•å™¨ã€‚å…¶ä¸­æ¯ä¸ª4ä½CLAä»è¿›ä½è¾“å…¥åˆ°è¿›ä½è¾“å‡ºæ˜¯ä¸¤çº§é—¨ç”µè·¯æ—¶å»¶ï¼ŒåŠ ä¸Šç¬¬ä¸€çº§CLAçš„PGæ—¶å»¶å’Œæœ€åä¸€çº§CLAçš„å¼‚æˆ–é—¨æ—¶å»¶ï¼Œè¿™ç§æ–¹å¼æ„æˆçš„Nä½è¶…å‰è¿›ä½åŠ æ³•å™¨çš„æ€»æ—¶å»¶ä¸º$1+2*(N/4)+1=N/2+2$ã€‚

å¦‚æœæƒ³è·å¾—æ›´å¿«çš„é€Ÿåº¦ï¼Œå°±å¾—é‡‡ç”¨å¦ä¸€ç§æ–¹æ³•â€”â€”**å¤šçº§è¶…å‰è¿›ä½åŠ æ³•å™¨**ã€‚å¤šçº§è¶…å‰è¿›ä½åŠ æ³•å™¨é‡‡ç”¨â€œç»„å†…è¶…å‰è¿›ä½ï¼Œç»„é—´ä¹Ÿè¶…å‰è¿›ä½â€çš„æ–¹å¼ï¼Œå¯è¿›ä¸€æ­¥é™ä½å› ç»„é—´ä¸²è”è¿›ä½å¸¦æ¥çš„æ—¶å»¶ã€‚å³å°†æ¯ä¸ª4ä½CLAçœ‹åšä¸€ä½å†ç”±è¶…å‰è¿›ä½é€»è¾‘å†æ¬¡è¿›è¡Œè¶…å‰è¿›ä½ï¼Œæ•…ç§°ä¸ºå¤šçº§è¶…å‰è¿›ä½åŠ æ³•å™¨ã€‚

> æœ¬ç« ä½ è¦å­¦ä¼šçš„
>
> - [ ] è¶…å‰è¿›ä½åŠ æ³•å™¨æ˜¯æ€ä¹ˆä¼˜åŒ–é™ä½æ—¶å»¶çš„
> - [ ] generate-forå¾ªç¯è°ƒç”¨æ¨¡å—
>
> ä¸€äº›å¯å‚è€ƒèµ„æ–™
>
> ã€Šæ•°å­—ç”µå­æŠ€æœ¯åŸºç¡€ã€‹é˜çŸ³ p172-176
>
> ã€Šè®¡ç®—æœºä½“ç³»ç»“æ„åŸºç¡€ã€‹èƒ¡ä¼Ÿæ­¦ p188-193
>
> [32ä½è¶…å‰è¿›ä½åŠ æ³•å™¨çš„è®¾è®¡-T-Tang-ç”µå­æŠ€æœ¯åº”ç”¨-AET-ä¸­å›½ç§‘æŠ€æ ¸å¿ƒæœŸåˆŠ-æœ€ä¸°å¯Œçš„ç”µå­è®¾è®¡èµ„æºå¹³å° (chinaaet.com)](http://blog.chinaaet.com/T_Tang/p/5100051382)
>
> [16ä½ä¸¤çº§è¶…å‰è¿›ä½åŠ æ³•å™¨çš„Verilogå®ç°åŠæ—¶å»¶åˆ†æ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/579055858?utm_id=0)

## ä¹˜æ³•å™¨

ä¸é‡‡ç”¨ä»»ä½•ä¼˜åŒ–ç®—æ³•çš„ä¹˜æ³•è¿‡ç¨‹ï¼Œå¯ä»¥ç”¨æˆ‘ä»¬å°å­¦å°±å­¦è¿‡çš„åˆ—ç«–å¼ä¹˜æ³•æ¥è¯´æ˜ã€‚ä»ä¹˜æ•°çš„ä½ä½å¼€å§‹ï¼Œæ¯æ¬¡å–ä¸€ä½ä¸è¢«ä¹˜æ•°ç›¸ä¹˜ï¼Œå…¶ä¹˜ç§¯ä½œä¸ºéƒ¨åˆ†ç§¯æš‚å­˜ï¼Œä¹˜æ•°çš„å…¨éƒ¨æœ‰æ•ˆä½éƒ½ä¹˜å®Œåï¼Œå†å°†æ‰€æœ‰éƒ¨åˆ†ç§¯æ ¹æ®å¯¹åº”ä¹˜æ•°æ•°ä½çš„æƒå€¼é”™ä½ç´¯åŠ ï¼Œå¾—åˆ°æœ€åçš„ä¹˜ç§¯ã€‚

<img src="img resources/ShuShi.jpg" alt="ShuShi" style="zoom:50%;" />

è¿™æ ·åŸå§‹çš„ä¹˜æ³•åœ¨è®¾è®¡ä¸Šæ˜¯å¯ä»¥å®ç°çš„ï¼Œä½†åœ¨å·¥ç¨‹åº”ç”¨ä¸Šå‡ ä¹ä¸ä¼šé‡‡ç”¨ï¼Œåœ¨æ—¶å»¶ä¸é¢ç§¯ä¸Šéƒ½éœ€è¦ä¼˜åŒ–ã€‚ä¸€ä¸ªNä½çš„ä¹˜æ³•è¿ç®—ï¼Œéœ€è¦äº§ç”ŸNä¸ªéƒ¨åˆ†ç§¯ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œå…¨åŠ å¤„ç†ï¼Œä½å®½è¶Šå¤§ï¼Œéƒ¨åˆ†ç§¯ä¸ªæ•°è¶Šå¤šï¼Œéœ€è¦çš„åŠ æ³•å™¨ä¹Ÿè¶Šå¤šï¼ŒåŠ æ³•å™¨å»¶æ—¶ä¹Ÿè¶Šå¤§ï¼Œé‚£ä¹ˆé’ˆå¯¹ä¹˜æ³•è¿ç®—çš„ä¼˜åŒ–ï¼Œä¸»è¦ä¹Ÿå°±é›†ä¸­åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š**ä¸€æ˜¯å‡å°‘åŠ æ³•å™¨å¸¦æ¥çš„å»¶æ—¶ï¼ŒäºŒæ˜¯å‡å°‘éƒ¨åˆ†ç§¯çš„ä¸ªæ•°**ã€‚

### è¡¥ç ç§»ä½ä¹˜æ³•å™¨

é¦–å…ˆè§£å†³è´Ÿæ•°ä¹˜æ³•é—®é¢˜ã€‚åœ¨åŠ å‡æ³•ä¸­æˆ‘ä»¬é‡‡ç”¨è¡¥ç è§£å†³è´Ÿæ•°å’Œå‡æ³•é—®é¢˜ï¼Œåœ¨è´Ÿæ•°ä¹˜æ³•ä¸­åŒæ ·å¯ä»¥ä½¿ç”¨è¡¥ç ã€‚

å‡å®šæœ‰ 8 ä½å®šç‚¹æ•° $Y$ï¼Œ $[Y]_è¡¥$  çš„äºŒè¿›åˆ¶æ ¼å¼å†™ä½œ $y_7 y_6 y_5 y_4 y_3 y_2 y_1 y_0$ ï¼Œæ ¹æ®è¡¥ç å®šä¹‰ï¼Œ$Y$ çš„å€¼ç­‰äº
$$
Y=y_{7}\times -2^{7}+y_{6}\times 2^{6}+y_{5}\times 2^{5}+\ldots +y_{0}\times 2^{0}
$$
ç”±æ­¤å¯å¾—å‡º
$$
\begin{aligned}\left[ X\times Y\right] _{è¡¥}&=\left[   X\times (y _{7}\times -2^{7}+y_{6}\times 2^{6}+\ldots +y_{0}\times 2^0) \right]_{è¡¥} \\
&=\left[X \times -y_7\times 2^{7}+X\times y_{6}\times 2^{6}+\ldots +X\times y_{0}\times 2^{0}\right] _{è¡¥}\\
&=\left[ X\times-y_{7}\times2^{7}\right] _{è¡¥}+\left[ X\times y_6\times 2^{6}\right] _{è¡¥}+\ldots +[  X\times y_{0}\times 2^{0}) _{è¡¥}\\
&=-y_{7}\times \left[ X \times 2^{7} \right] _{è¡¥} + y_{6}\times \left[ X \times 2^{6} \right] _{è¡¥}+\ldots +y_{0}\times \left[ X\times 2^{0}\right]_{è¡¥}\\
&=\left[ X\right] _{è¡¥}\times \left( -y_{7}\times 2^{7}+y_{6}\times 2^{6}+\ldots +y_{0}\times 2^{0} \right) \end{aligned}
$$


æ ¹æ®å…¬å¼å¯ä»¥ç”¨verilogè®¾è®¡å‡ºç®€å•çš„ç§»ä½è¡¥ç ä¹˜æ³•å™¨

```verilog
module mult_simple (
    input [7:0] op1,op2,
    output[15:0]out
);

wire [15:0] op1_ext = op1[7] ? {8'b11111111,op1} : {8'b0,op1};
wire [15:0] mult_buf [7:0];

generate
    genvar i;
    for (i = 0;i<8 ;i=i+1 ) begin
        assign mult_buf[i] = ~op2[i] ? 16'b0 : (op1_ext<<i);
    end
endgenerate

assign out = mult_buf[0] + mult_buf[1] + mult_buf[2] + mult_buf[3] 
           + mult_buf[4] + mult_buf[5] + mult_buf[6] - mult_buf[7];
endmodule
```

### åè±å£«æ ‘

ç”±äºç´¯åŠ å™¨æœ¬èº«çš„è¿›ä½ä¼ é€’å»¶æ—¶å¯¹ç”µè·¯æ€§èƒ½ä¾ç„¶å­˜åœ¨éå¸¸å¤§çš„å½±å“ï¼Œæ‰€ä»¥ä¼˜åŒ–çš„ç¬¬ä¸€ä¸ªæ–¹é¢ï¼Œå°±æ˜¯æ”¹è¿›éƒ¨åˆ†ç§¯ç´¯åŠ ç»“æ„ï¼Œæå‡ç´¯åŠ æ€§èƒ½ã€‚å¦‚æœé‡‡ç”¨éƒ¨åˆ†ç§¯ç›´æ¥ç›¸åŠ çš„æ–¹å¼ï¼Œå› ä¸ºå…¨åŠ å™¨è¿›ä½çš„å…³ç³»ï¼Œå½“å‰bitçš„ç›¸åŠ ç»“æœä¾èµ–äºå®ƒå‰ä¸€bitçš„è¿›ä½è¾“å‡ºï¼Œæ•´ä¸ªè®¡ç®—è¿‡ç¨‹ç›¸å½“äºä¸²è¡ŒåŒ–ï¼Œä½å®½è¶Šå¤§ï¼Œå»¶æ—¶è¶Šå¤§ï¼Œæ‰€ä»¥ä¼˜åŒ–çš„å…³é”®å°±æ˜¯æ¶ˆé™¤è¿›ä½é“¾ï¼Œä½¿è¿ç®—å¹¶è¡ŒåŒ–ã€‚

è¿›ä½ä¿ç•™åŠ æ³•å™¨ï¼ˆCarry Save Adder, CSAï¼‰æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§ä¼˜åŒ–æ–¹å¼ï¼ŒCSAå®é™…ä¸Šå°±æ˜¯ä¸€ä½å…¨åŠ å™¨ã€‚åœ¨ä¸Šä¸€ç« ä¸­æˆ‘ä»¬å­¦ä¹ äº†å…¨åŠ å™¨æœ‰3ä¸ªè¾“å…¥A,B,CIå’Œ2ä¸ªè¾“å‡ºS,COï¼Œé€šè¿‡CIå’Œä¸Šä¸€çº§COç›¸æ¥å®ç°ä¸²è¡Œçš„åŠ æ³•ï¼Œä½†æ˜¯åœ¨CSAä¸­æˆ‘ä»¬ä¿ç•™æ¯ä¸€ä½çš„COï¼ŒCIä½¿ç”¨å¦å¤–ä¸€ä¸ªåŠ æ•°Dæ¥æ›¿ä»£ï¼Œå³
$$
A+B+D=S+\{C,0\}
$$
è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†3ä¸ªåŠ æ•°å˜ä¸º2ä¸ªåŠ æ•°çš„åŠ æ•°ç¼©å‡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å°†åŠ æ•°å‡å°‘äº†1/3ï¼Œå¦‚æœæˆ‘ä»¬å†å¾€ååŠ ä¸€å±‚åŒæ ·çš„CSAï¼Œå¯ä»¥è¿›ä¸€æ­¥å‡å°‘åŠ æ•°ï¼Œç›´åˆ°åªå‰©ä¸¤ä¸ªåŠ æ•°å³å¯ä½¿ç”¨ä¸€ä¸ªåŠ æ³•å™¨å¾—åˆ°æœ€ç»ˆç»“æœã€‚å¯¹äºNä¸ªåŠ æ•°çš„åŠ æ³•ï¼Œä½¿ç”¨ä¸²è¡ŒåŠ æ³•å™¨éœ€è¦N-1ä¸ªåŠ æ³•å™¨çš„å»¶æ—¶ï¼Œä½¿ç”¨å¤šå±‚åè±å£«æ ‘å¤§è‡´éœ€è¦$log_{1.5}(0.5N)$ä¸ªåŠ æ³•å™¨å»¶è¿Ÿï¼Œæ˜¾ç„¶æ˜æ˜¾åœ°é™ä½è®¡ç®—å»¶è¿Ÿï¼Œæ•°æ®å®½åº¦è¶Šå®½ï¼Œå…¶æ•ˆæœè¶Šæ˜æ˜¾ã€‚ 

ä¸‹é¢ä¸º8ä¸ª1ä½æ•°ç›¸åŠ çš„å››å±‚åè±å£«æ ‘ç»“æ„å›¾ï¼ŒåŒæ ·ä¹Ÿå¯å°†1ä½æ•°æ‰©å±•ä¸ºå¤šä½æ•°ï¼Œç»“æ„æ˜¯ç›¸ä¼¼çš„ã€‚

![wallace](img resources/wallace.jpg)

**æ³¨æ„æ¯ä¸€å±‚çš„è¿›ä½ä¿¡å·åªèƒ½æ¥åˆ°ä¸‹ä¸€å±‚ï¼Œä¸èƒ½æ¥åˆ°ä¸Šä¸€å±‚**

```verilog
module compressor32 (
    input [15:0] op1,op2,op3,
    output[15:0] out1,out2
);

assign out1 = op1^op2^op3;
assign out2 = (op1&op2|op2&op3|op3&op1)<<1;
    
endmodule
```

åŒæ ·ä¹Ÿå¯ä»¥è®¾è®¡4-2å‹ç¼©çš„åè±å£«æ ‘

### boothä¹˜æ³•å™¨

å¦‚æœéµå¾ªç¬¬ä¸€èŠ‚çš„è¡¥ç ä¹˜æ³•ç®—æ³•ï¼Œéœ€è¦ç‰¹åœ°æŒ‘å‡ºç¬¬ N ä¸ªéƒ¨åˆ†ç§¯ï¼Œå¹¶ä½¿ç”¨è¡¥ç å‡æ³•æ“ä½œï¼Œè¿™å°±éœ€è¦å®ç°ä¸€ä¸ªé¢å¤–çš„çŠ¶æ€æœºæ¥æ§åˆ¶ï¼Œå¢åŠ äº†ç¡¬ä»¶è®¾è®¡å¤æ‚åº¦ã€‚ å› æ­¤å¯¹è¡¥ç ä¹˜æ³•å…¬å¼è¿›è¡Œå˜æ¢
$$
\begin{aligned}
Y&=-y_{7}\times 2^{7}+y_{6}\times 2^{6}+y_{5}\times 2^{5}+\ldots +y_{0}\times 2^{0}\\
&=\left( -y_7 \times 2^{7}+\left( y_{6}\times 2^{7}-y_{6}\times 2^{6}\right) +\left( y_{5}\times 2^{6}-y_{5}\times 2^{5}\right) +\ldots
 +\left( y_1\times 2^{2}-y_1\times 2^{1}\right) +\left( y_{0}\times 2^1- y_{0}\times 2^{0}\right) +\left( 0\times 2^{0}\right) \right) \\
&=\left( y_{6}-y_{7}\right) \times 2^{7}+\left( y_{5}-y_{6}\right) \times 2^{6}+\ldots +\left( y_{0}-y_{1}\right) \times 2^{1}+
\left( y_{-1}-y_{0}\right) \times 2^{0}\end{aligned}
$$
å…¶ä¸­$y_{-1}$å–å€¼ä¸º 0ã€‚ ç»è¿‡å˜æ¢ï¼Œå…¬å¼å˜å¾—æ›´åŠ è§„æ•´ï¼Œä¸å†éœ€è¦ä¸“é—¨å¯¹æœ€åä¸€æ¬¡éƒ¨åˆ†ç§¯é‡‡ç”¨è¡¥ç å‡æ³•ï¼Œæ›´é€‚åˆç¡¬ä»¶å®ç°ã€‚ è¿™ä¸ªæ–°å…¬å¼è¢«ç§°ä¸º Booth ä¸€ä½ä¹˜ç®—æ³•ã€‚

æ ¹æ®ç®—æ³•å…¬å¼ï¼Œå¾ˆå®¹æ˜“å¾—å‡ºå®ƒçš„è§„åˆ™

| $y_i$ | $y_{i-1}$ |   æ“ä½œ    |
| :---: | :-------: | :-------: |
|   0   |     0     |     0     |
|   0   |     1     | $+[X]_è¡¥$ |
|   1   |     0     | $-[X]_è¡¥$ |
|   1   |     1     |     0     |

äºæ˜¯æˆ‘ä»¬å¯ä»¥è®¾è®¡å‡ºboothä¸€ä½ä¹˜

```verilog
module compressor32 (//åè±å£«æ ‘32å‹ç¼©
    input [15:0] op1,op2,op3,
    output[15:0] out1,out2
);

assign out1 = op1^op2^op3;
assign out2 = (op1&op2|op2&op3|op3&op1)<<1;
    
endmodule

module mult_booth1 (//boothä¸€ä½ä¹˜
    input signed [7:0] op1,op2,
    output signed [15:0] out
);

wire signed [15:0] op1_ext = op1[7] ? {8'b11111111,op1} : {8'b0,op1};
wire signed [15:0] mult_buf [7:0];

generate
    genvar i;
    for (i = 0; i < 8; i = i + 1) begin
        if (i == 0) begin
            assign mult_buf[0] = op2[0] ? -op1_ext : 0;
        end else begin
            assign mult_buf[i] = op2[i] ^ op2[i - 1] ? (op2[i] ? -op1_ext : op1_ext) : 0;
        end
    end  
endgenerate

wire [15:0] wallace1_buf [11:0];
begin:wallace1
    compressor32 wallace1_1(mult_buf[0],mult_buf[1]<<1,mult_buf[2]<<2,wallace1_buf[0],wallace1_buf[1]);
    compressor32 wallace1_2(mult_buf[3]<<3,mult_buf[4]<<4,mult_buf[5]<<5,wallace1_buf[2],wallace1_buf[3]);
end
begin:wallace2
    compressor32 wallace2_1(wallace1_buf[0],wallace1_buf[1],wallace1_buf[2],wallace1_buf[4],wallace1_buf[5]);
    compressor32 wallace2_2(wallace1_buf[3],mult_buf[6]<<6,mult_buf[7]<<7,wallace1_buf[6],wallace1_buf[7]);
end
begin:wallace3
    compressor32 wallace3(wallace1_buf[4],wallace1_buf[5],wallace1_buf[6],wallace1_buf[8],wallace1_buf[9]);
end
begin:wallace4
    compressor32 wallace4(wallace1_buf[8],wallace1_buf[9],wallace1_buf[7],wallace1_buf[10],wallace1_buf[11]);
end
begin:adder
    assign out = wallace1_buf[10] + wallace1_buf[11];
end
endmodule
```



åœ¨ Booth ä¸€ä½ä¹˜ç®—æ³•ä¸­ï¼Œä¸ºäº†è®¡ç®— N ä½çš„è¡¥ç ä¹˜æ³•, ä¾ç„¶éœ€è¦ N-1 æ¬¡åŠ æ³•ã€‚ è€Œæ•°æ®å®½åº¦è¾ƒå¤§çš„è¡¥ç åŠ æ³•å™¨é¢ç§¯å¤§ã€ç”µè·¯å»¶è¿Ÿé•¿ï¼Œé™åˆ¶äº†ç¡¬ä»¶ä¹˜æ³•å™¨çš„è®¡ç®—é€Ÿåº¦ï¼Œæ‰€ä»¥ä¼˜åŒ–çš„ç¬¬äºŒä¸ªæ–¹é¢å°±æ˜¯å‡å°‘éƒ¨åˆ†ç§¯çš„ä¸ªæ•°ã€‚é‡æ–°å¯¹è¡¥ç ä¹˜æ³•å…¬å¼è¿›è¡Œå˜æ¢ï¼Œå¾—åˆ° Booth ä¸¤ä½ä¹˜ç®—æ³•ã€‚
$$
ğ‘Œ=(ğ‘¦_5+ğ‘¦_6âˆ’2ğ‘¦_7 )Ã—2^6+(ğ‘¦_3+ğ‘¦_4âˆ’2ğ‘¦_5 )Ã—2^4+â‹¯+(ğ‘¦_{âˆ’1}+ğ‘¦_0âˆ’2ğ‘¦_1 )Ã—2^0
$$
æ ¹æ®ç®—æ³•å…¬å¼ï¼Œå¾ˆå®¹æ˜“å¾—å‡ºå®ƒçš„è§„åˆ™

| $y_{i+1}$ | $y_{i}$ | $y_{i-1}$ | æ“ä½œ       |
| :-------: | :-----: | :-------: | ---------- |
|     0     |    0    |     0     | 0          |
|     0     |    0    |     1     | $+[X]_è¡¥$  |
|     0     |    1    |     0     | $+[X]_è¡¥$  |
|     0     |    1    |     1     | $+2[X]_è¡¥$ |
|     1     |    0    |     0     | $-2[X]_è¡¥$ |
|     1     |    0    |     1     | $-[X]_è¡¥$  |
|     1     |    1    |     0     | $-[X]_è¡¥$  |
|     1     |    1    |     1     | 0          |

*äºæ˜¯ä½ ä»¬å°±å¯ä»¥è®¾è®¡ä¸€ä¸ª8ä½boothäºŒä½ä¹˜ä¹˜æ³•å™¨äº†*

>æœ¬ç« ä½ è¦å­¦ä¼šçš„
>
>- [ ] è¡¥ç ä¹˜æ³•
>- [ ] å¹¶è¡ŒåŒ–ä¼˜åŒ–æ€è·¯
>
>ä¸€äº›å‚è€ƒèµ„æ–™
>
>ã€Šè®¡ç®—æœºä½“ç³»ç»“æ„åŸºç¡€ã€‹èƒ¡ä¼Ÿæ­¦ p196-206
>
>ã€ŠCPUè®¾è®¡å®æˆ˜ã€‹p140-146
>
>[ä¹˜æ³•å™¨çš„å¸ƒæ–¯ç®—æ³•åŸç†ä¸VERILOGå®ç° - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/127164011)
>
>[å…«ä½â€œBoothäºŒä½ä¹˜ç®—æ³•â€ä¹˜æ³•å™¨ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/291239777)
